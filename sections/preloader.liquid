{% if section.settings.enable_preloader and section.settings.preloader_image %}
  <div id="preloader" class="preloader desktop-preloader" style="background-color: {{ section.settings.preloader_background | default: '#0E0E10' }}; opacity: 1;">
    <div class="preloader-content" style="background-color: {{ section.settings.preloader_background | default: '#0E0E10' }};">
      <img 
        src="{{ section.settings.preloader_image | image_url: width: section.settings.preloader_size }}" 
        alt="Loading..." 
        class="preloader-image"
        width="{{ section.settings.preloader_size }}"
        height="{{ section.settings.preloader_size }}"
        style="opacity: 0; transition: opacity 0.3s ease-in;"
        onload="this.style.opacity='1'; document.getElementById('desktop-preloader-text').style.opacity='1'; this.parentElement.parentElement.style.setProperty('--atmosphere-opacity', '1'); document.body.style.visibility='visible';"
      >
    </div>
    <div class="preloader-text" style="opacity: 0; transition: opacity 0.3s ease-in;" id="desktop-preloader-text">STAY BOLD</div>
  </div>
{% endif %}

{% if section.settings.enable_mobile_preloader and section.settings.mobile_preloader_image %}
  <div id="mobile-preloader" class="preloader mobile-preloader" style="background-color: {{ section.settings.mobile_preloader_background | default: '#0E0E10' }}; opacity: 1;">
    <div class="preloader-content" style="background-color: {{ section.settings.mobile_preloader_background | default: '#0E0E10' }};">
      <img 
        src="{{ section.settings.mobile_preloader_image | image_url: width: section.settings.mobile_preloader_size }}" 
        alt="Loading..." 
        class="preloader-image"
        width="{{ section.settings.mobile_preloader_size }}"
        height="{{ section.settings.mobile_preloader_size }}"
        style="opacity: 0; transition: opacity 0.3s ease-in;"
        onload="this.style.opacity='1'; document.getElementById('mobile-preloader-text').style.opacity='1'; this.parentElement.parentElement.style.setProperty('--atmosphere-opacity', '1'); document.body.style.visibility='visible';"
      >
    </div>
    <div class="preloader-text mobile-stacked" style="opacity: 0; transition: opacity 0.3s ease-in;" id="mobile-preloader-text">
      <div class="preloader-text-line">STAY</div>
      <div class="preloader-text-line">BOLD</div>
    </div>
  </div>
{% endif %}

<style>
  /* Preloader styles */
  .preloader {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    opacity: 1;
  }

  .preloader {
    --atmosphere-opacity: 0;
  }
  
  .preloader::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: 
      radial-gradient(ellipse at center, transparent 30%, rgba(215, 38, 56, 0.03) 70%, rgba(215, 38, 56, 0.06) 100%),
      linear-gradient(to right, rgba(215, 38, 56, 0.08) 0%, rgba(139, 30, 43, 0.04) 25%, rgba(139, 30, 43, 0.02) 50%, rgba(139, 30, 43, 0.04) 75%, rgba(215, 38, 56, 0.08) 100%);
    pointer-events: none;
    z-index: 3;
    opacity: var(--atmosphere-opacity);
    transition: opacity 0.3s ease-in;
  }

  .preloader-content {
    text-align: center;
    position: relative;
    z-index: 2;
  }

  .preloader-image {
    width: 100vw;
    height: 100vh;
    object-fit: cover;
    object-position: center center;
    opacity: 1;
  }

  .preloader-text {
    position: absolute;
    bottom: 10%;
    left: 50%;
    transform: translateX(-50%);
    font-family: 'Oswald', sans-serif;
    font-size: clamp(2rem, 5vw, 4rem);
    font-weight: 700;
    color: rgba(139, 30, 43, 1);
    text-transform: uppercase;
    letter-spacing: 0.2em;
    text-shadow: 
      0 0 10px rgba(139, 30, 43, 0.8),
      0 0 20px rgba(139, 30, 43, 0.6),
      0 0 30px rgba(139, 30, 43, 0.4),
      0 0 40px rgba(139, 30, 43, 0.2);
    z-index: 4;
    animation: pulse-glow 2s ease-in-out infinite alternate;
  }

  @keyframes pulse-glow {
    0% {
      text-shadow: 
        0 0 10px rgba(139, 30, 43, 0.8),
        0 0 20px rgba(139, 30, 43, 0.6),
        0 0 30px rgba(139, 30, 43, 0.4),
        0 0 40px rgba(139, 30, 43, 0.2);
    }
    100% {
      text-shadow: 
        0 0 15px rgba(139, 30, 43, 1),
        0 0 25px rgba(139, 30, 43, 0.8),
        0 0 35px rgba(139, 30, 43, 0.6),
        0 0 45px rgba(139, 30, 43, 0.4);
    }
  }

  /* Desktop preloader - hidden on mobile */
  .desktop-preloader {
    display: flex;
  }

  /* Mobile preloader - hidden on desktop */
  .mobile-preloader {
    display: none;
  }

  @media (max-width: 768px) {
    .desktop-preloader {
      display: none;
    }
    
    .mobile-preloader {
      display: flex;
    }
    
    .mobile-preloader .preloader-text {
      left: 32%;
    }
    
    .mobile-stacked {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0;
      animation: mobile-pulse-glow 2s ease-in-out infinite alternate;
    }
    
    .preloader-text-line {
      line-height: 0.8;
      margin: 0;
      color: rgba(139, 30, 43, 1);
      text-shadow: 
        0 0 5px rgba(139, 30, 43, 0.4),
        0 0 10px rgba(139, 30, 43, 0.3),
        0 0 15px rgba(139, 30, 43, 0.2);
    }
    
    @keyframes mobile-pulse-glow {
      0% {
        filter: drop-shadow(0 0 5px rgba(139, 30, 43, 0.4)) 
                drop-shadow(0 0 10px rgba(139, 30, 43, 0.3));
      }
      100% {
        filter: drop-shadow(0 0 8px rgba(139, 30, 43, 0.6)) 
                drop-shadow(0 0 12px rgba(139, 30, 43, 0.4));
      }
    }
  }
</style>

<script>
  // Preloader function
  window.addEventListener('load', function() {
    
    const desktopPreloader = document.getElementById('preloader');
    const mobilePreloader = document.getElementById('mobile-preloader');
    
    // Determine which preloader to use based on screen size
    const isMobile = window.innerWidth <= 768;
    const activePreloader = isMobile ? mobilePreloader : desktopPreloader;
    
    if (activePreloader) {
      // Hide preloader after delay
      setTimeout(function() {
        activePreloader.style.transition = 'opacity 0.5s ease-out';
        activePreloader.style.opacity = '0';
        
        setTimeout(function() {
          activePreloader.style.display = 'none';
        }, 500);
      }, 1750);
    }
  });
</script>

{% schema %}
{
  "name": "Preloader",
  "tag": "section",
  "settings": [
    {
      "type": "checkbox",
      "id": "enable_preloader",
      "label": "Enable Desktop Preloader",
      "default": true
    },
    {
      "type": "image_picker",
      "id": "preloader_image",
      "label": "Desktop Preloader Image"
    },
    {
      "type": "range",
      "id": "preloader_size",
      "label": "Desktop Preloader Size",
      "min": 100,
      "max": 2000,
      "step": 50,
      "default": 800
    },
    {
      "type": "color",
      "id": "preloader_background",
      "label": "Desktop Preloader Background Color",
      "default": "#0E0E10"
    },
    {
      "type": "checkbox",
      "id": "enable_mobile_preloader",
      "label": "Enable Mobile Preloader",
      "default": true
    },
    {
      "type": "image_picker",
      "id": "mobile_preloader_image",
      "label": "Mobile Preloader Image"
    },
    {
      "type": "range",
      "id": "mobile_preloader_size",
      "label": "Mobile Preloader Size",
      "min": 100,
      "max": 1500,
      "step": 50,
      "default": 600
    },
    {
      "type": "color",
      "id": "mobile_preloader_background",
      "label": "Mobile Preloader Background Color",
      "default": "#0E0E10"
    }
  ]
}
{% endschema %}