{% comment %}
  This section is used in the password template to render landing page shown
  when password protection is applied to a store.

  https://shopify.dev/docs/storefronts/themes/architecture/templates/password
{% endcomment %}

{% if section.settings.enable_preloader and section.settings.preloader_image %}
  <div id="preloader" class="preloader" style="background-color: {{ section.settings.preloader_background | default: '#0E0E10' }};">
    <div class="preloader-content">
      <img 
        src="{{ section.settings.preloader_image | image_url: width: section.settings.preloader_size }}" 
        alt="Loading..." 
        class="preloader-image"
        width="{{ section.settings.preloader_size }}"
        height="{{ section.settings.preloader_size }}"
      >
    </div>
  </div>
{% endif %}

<div class="password-content" {% if section.settings.enable_preloader and section.settings.preloader_image %}style="display: none;"{% endif %}>
  <h1>{{ 'password.title' | t }}</h1>

{% if shop.password_message %}
  <p>{{ shop.password_message }}</p>
{% endif %}

{% form 'storefront_password' %}
  {% if form.errors %}
    {{ form.errors | default_errors }}
  {% endif %}

  <label for="password-input">
    {{ 'password.password' | t }}
  </label>

  <input type="password" name="password" id="password-input">

  <button type="submit">
    {{ 'password.enter' | t }}
  </button>
{% endform %}
</div>

{% if section.settings.enable_preloader and section.settings.preloader_image %}
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const preloader = document.getElementById('preloader');
      const content = document.querySelector('.password-content');
      
      if (preloader && content) {
        // Hide preloader and show content after a delay
        setTimeout(function() {
          preloader.style.opacity = '0';
          setTimeout(function() {
            preloader.style.display = 'none';
            content.style.display = 'block';
            content.style.opacity = '0';
            setTimeout(function() {
              content.style.opacity = '1';
            }, 50);
          }, 500);
        }, 1500);
      }
    });
  </script>
{% endif %}

{% stylesheet %}
  .preloader {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    transition: opacity 0.5s ease-out;
  }
  
  .preloader-content {
    text-align: center;
  }
  
  .preloader-image {
    max-width: 100%;
    height: auto;
  }
  
  .password-content {
    transition: opacity 0.3s ease-in;
    padding: 2rem;
    max-width: 400px;
    margin: 0 auto;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
  }
  
  .password-content h1 {
    color: var(--color-foreground);
    margin-bottom: 1rem;
  }
  
  .password-content p {
    color: var(--color-foreground);
    margin-bottom: 2rem;
  }
  
  .password-content label {
    color: var(--color-foreground);
    display: block;
    margin-bottom: 0.5rem;
  }
  
  .password-content input {
    width: 100%;
    padding: 0.75rem;
    margin-bottom: 1rem;
    background-color: var(--color-background-ui);
    border: 2px solid var(--color-background-muted);
    border-radius: var(--style-border-radius-inputs);
    color: var(--color-foreground);
    font-size: 1rem;
  }
  
  .password-content input:focus {
    outline: none;
    border-color: var(--color-accent-red);
  }
  
  .password-content button {
    width: 100%;
    padding: 0.75rem 1.5rem;
    background-color: var(--color-accent-red);
    color: var(--color-foreground);
    border: none;
    border-radius: var(--style-border-radius-inputs);
    font-size: 1rem;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }
  
  .password-content button:hover {
    background-color: #b91e2e;
  }
{% endstylesheet %}

{% schema %}
{
  "name": "t:general.password",
  "settings": [
    {
      "type": "image_picker",
      "id": "preloader_image",
      "label": "Preloader Image"
    },
    {
      "type": "range",
      "id": "preloader_size",
      "min": 50,
      "max": 200,
      "step": 10,
      "unit": "px",
      "label": "Preloader Size",
      "default": 100
    },
    {
      "type": "checkbox",
      "id": "enable_preloader",
      "label": "Enable Image Preloader",
      "default": true
    },
    {
      "type": "color",
      "id": "preloader_background",
      "label": "Preloader Background Color",
      "default": "#0E0E10"
    }
  ]
}
{% endschema %}
